<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


	<meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  script-src 'self' 'unsafe-inline' 'unsafe-eval' https://apis.google.com https://accounts.google.com https://cdn.jsdelivr.net https://www.gstatic.com https://www.googleapis.com;
  style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.jsdelivr.net;
  img-src 'self' data:;
  connect-src 'self' https://www.googleapis.com https://accounts.google.com https://securetoken.googleapis.com https://firestore.googleapis.com wss://*.firebaseio.com;
  frame-src 'self' https://accounts.google.com https://drive.google.com;
  font-src 'self' https://fonts.gstatic.com;
  object-src 'none';
">

	<script>
  function loadGoogleApi() {
    const script = document.createElement("script");
	
    script.src = "https://apis.google.com/js/api.js";
    script.onload = initGoogleAuth;
    document.head.appendChild(script);
  }

  window.onload = loadGoogleApi;
</script>




  	<title>Note's</title>
	<link rel="icon" href="lock.png" type="image/png" />
	
    <style>
        body {
            background-color: #1e1e2f;
            color: #ffffff;
            font-family: "Courier New", Courier, monospace;
            max-width: 600px;
            margin: 0 auto;
            padding: 0px 15px;
        }

        h2, h3 {
            text-align: center;
            margin-bottom: 20px;
        }

        input, button {
            font-family: "Courier New", Courier, monospace;
            font-size: 16px;
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            box-sizing: border-box;
            border: none;
            border-radius: 5px;
        }

        input {
            background-color: #2a2a40;
            color: #fff;
            border: 1px solid #444;
        }

        button {
            background-color: #03a9f4;
            color: white;
            transition: background 0.3s ease;
        }

        button:hover {
            background-color: #0288d1;
        }

        #guncelleBtn {
            background-color: #8bc34a;
        }

        #guncelleBtn:hover {
            background-color: #689f38;
        }

        #kayitListesi {
            margin-top: 30px;
            border-top: 1px solid #555;
            padding-top: 15px;
        } 
		#kayitListesi  button{
            margin-top: 10px;
            border-top: 1px solid #555;
        
		
        }

        ul {
            list-style: none;
            padding-left: 0;
        }

.listeSatiri {
position: relative; /* √áocuk elementlerin (kayitZamani) konumlandƒ±rƒ±lmasƒ± i√ßin */
    background-color: #2a2a40;
    border: 1px solid #444;
    border-radius: 6px;
    padding: 10px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
	 padding-top: 30px; /* Zaman alanƒ± i√ßin yukarƒ±dan bo≈üluk bƒ±rakƒ±n */
}
.kayitZamani {
    position: absolute; /* .listeSatiri'ye g√∂re konumlandƒ±rma */
    top: 5px; /* √ústten biraz bo≈üluk */
    left: 50%; /* Yatayda ortaya */
    transform: translateX(-50%); /* Kendi geni≈üliƒüinin yarƒ±sƒ± kadar sola kaydƒ±rarak tam ortaya */
    font-size: 11px; /* Daha k√º√ß√ºk font */
    color: #bbb; /* Biraz daha soluk renk */
    background-color: #3a3a5a; /* Hafif bir arka plan */
    padding: 2px 8px;
    border-radius: 3px;
    white-space: nowrap; /* Metnin tek satƒ±rda kalmasƒ±nƒ± saƒülar */
    box-shadow: 0 1px 3px rgba(0,0,0,0.2); /* Hafif g√∂lge */
    z-index: 1; /* Diƒüer i√ßeriklerin √ºzerinde g√∂r√ºnmesini saƒülar */
}

.listeSatiri span {
    flex-grow: 1;
    word-break: break-word;
}

.listeSatiri .butonGrubu {
flex-direction: column;
    display: flex;
    gap: 6px;
}

.listeSatiri button {
    font-size: 13px;
    padding: 6px 10px;
    border-radius: 4px;
    border: none;
    width: 80px;
    cursor: pointer;
}

.listeSatiri .duzenleBtn {
    background-color: #f57c00;
    color: white;
}

.listeSatiri .duzenleBtn:hover {
    background-color: #ef6c00;
}

.listeSatiri .silBtn {
    background-color: #e53935;
    color: white;
}

.listeSatiri .silBtn:hover {
    background-color: #c62828;
}

.logoutBtn {
    background-color: #3498db;
    color: #fff;
    border: none;
    padding: 10px 20px;
  
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
    float: right;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}

.logoutBtn:hover {
    background-color: #7b1fa2;
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}





    #notPopup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #ffffff;
      color: #000;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
      z-index: 999;
      width: 90%;
      max-width: 500px;
    }

    #notMetni {
      width: 90%;
      height: 200px;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
      resize: vertical;
    }

    .popup-buttons {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
    }

    .popup-buttons button {
      padding: 10px 20px;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .saveBtn {
      background-color: #27ae60;
      color: white;
    }

    .cancelBtn {
      background-color: #e74c3c;
      color: white;
    }

    body.popup-acik::before {
      content: "";
      position: fixed;
      top: 0; left: 0; bottom: 0; right: 0;
      background-color: rgba(0, 0, 0, 0.4);
      z-index: 998;
    }

.uc-lu {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
}

.aramaKutusu {
flex: 1; /* T√ºm bo≈üluƒüu kaplasƒ±n */
    position: relative;
}
#kelimeBul {
  flex: 1 1 80%;
  padding: 8px;
  font-size: 16px;
}
.temizleBtn {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  font-size: 14px;
  color: #999;
  display: none;
}
#notEkleBtn {
  flex: 0 0 10%;
  padding: 8px;
  font-size: 16px;
  cursor: pointer;
}

.logoutBtn {
  flex: 0 0 10%;
  padding: 8px;
  font-size: 16px;
  cursor: pointer;
}
#notEkleBtn:hover {
    background-color: #7b1fa2;
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

#notBaslik {
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 24px;
    font-weight: bold;
}

.temizleBtn  {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  font-size: 14px;
  color: #999;
  display: none; /* Ba≈ülangƒ±√ßta gizli */
}



.header-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  position: relative;
}

.dropdown {
  position: relative;
  display: inline-block;
}

.dropdown-btn {
  background-color: #4a6fa5;
  color: white;
  padding: 8px 15px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-family: "Courier New", Courier, monospace;
  transition: all 0.3s;
}

.dropdown-btn:hover {
  background-color: #3a5a80;
}

.dropdown-content {
  display: none;
  position: absolute;
  right: 0;
  background-color: #2a2a40;
  min-width: 160px;
  box-shadow: 0px 8px 16px rgba(0,0,0,0.2);
  z-index: 1;
  border-radius: 5px;
  border: 1px solid #444;
}

.dropdown-content a {
  color: #fff;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  font-size: 14px;
}

.dropdown-content a:hover {
  background-color: #3a3a5a;
}

.show { display: block; }


/* SweetAlert √∂zelle≈ütirmeleri */
.swal2-popup {
  background: #2a2a40 !important;
  color: #fff !important;
}

.swal2-input, .swal2-textarea {
  background: #1e1e2f !important;
  color: #fff !important;
  border: 1px solid #444 !important;
}

.swal2-textarea {
  height: 100px;
  resize: vertical;
}
    </style>
</head>
<body>

<div id="loginSection">
    <h2>Giri≈ü Yap</h2>
    <input type="email" id="emailInput" placeholder="Email">
    <input type="password" id="passwordInput" placeholder="≈ûifre">
    <button onclick="login()">Giri≈ü Yap</button>
    
    <p style="text-align: center; margin-top: 15px; margin-bottom: 5px; font-size: 15px;">
        Hesabƒ±nƒ±z yok mu? 
        <a href="javascript:void(0);" onclick="showSignup()"
           style="color: #03a9f4; text-decoration: none; transition: color 0.3s ease, text-decoration 0.3s ease;">
           Kayƒ±t ol
        </a>
    </p>
    
    <p style="text-align: center; margin-top: 5px; margin-bottom: 20px; font-size: 15px;">
        <a href="javascript:void(0);" onclick="resetPassword()"
           style="color: #03a9f4; text-decoration: none; transition: color 0.3s ease, text-decoration 0.3s ease;">
           ≈ûifremi Unuttum
        </a>
    </p>
</div>

<div id="signupSection" style="display:none;">
    <h2>Kayƒ±t Ol</h2>
    <input type="email" id="signupEmail" placeholder="Email">
    <input type="password" id="signupPassword" placeholder="≈ûifre">
    <button onclick="signup()">Kayƒ±t Ol</button>
    
    <p style="text-align: center; margin-top: 15px; margin-bottom: 20px; font-size: 15px;">
        Hesabƒ±nƒ±z var mƒ±? 
        <a href="javascript:void(0);" onclick="showLogin()"
           style="color: #03a9f4; text-decoration: none; transition: color 0.3s ease, text-decoration 0.3s ease;">
           Giri≈ü yap
        </a>
    </p>
    
    <p id="signupMessage" style="color: #8bc34a; display: none;">Kayƒ±t olu≈üturuldu, giri≈ü yapƒ±n.</p>
</div>






  <!-- ƒ∞√ßerik B√∂l√ºm√º -->
  
<div id="kayitListesi" style="display:none;">
<p id="hosgeldinYazi" style="text-align:center; margin-top: 10px; font-weight: bold;"></p>


  <h5 id="notBaslik">Note's</h5>







<div class="uc-lu">
    <button class="logoutBtn" onclick="logout()" title="√áƒ±kƒ±≈ü">üîì</button>
   <div class="aramaKutusu">
    <input type="text" id="kelimeBul" placeholder="Ara">
   <span class="temizleBtn" onclick="temizleInput()">‚ùå</span>
</div>
  <button id="notEkleBtn" title="Not Ekleyin...">üìù</button>
  
<div class="dropdown">
        <button class="dropdown-btn">‚ò∞ Men√º</button>
     <div class="dropdown-content">
    <a href="#" id="iletisimAc">üì© ƒ∞leti≈üim</a>
    <a href="#" id="ayarlarAc">‚öôÔ∏è Ayarlar</a>
    <a href="#" id="yardimAc">‚ùì Yardƒ±m</a>
	<button onclick="notlariIndir()">‚¨áÔ∏è Notlarƒ± ƒ∞ndir</button>
	 <a href="#" id="emailDegistirAc">üìß E-posta Deƒüi≈ütir</a>

</div>
    </div>
	
</div>


  <!-- Not Popup Kutusu -->
  <div id="notPopup">
    <h3 style="margin-top: 0;">Notlarƒ±m</h3>
    <textarea id="notMetni" placeholder="Notlarƒ±nƒ±zƒ± buraya yazƒ±n..."></textarea>
    <div  class="popup-buttons">
      <button  class="saveBtn" onclick="notKaydet()">Kaydet</button>
      <button class="cancelBtn" onclick="popupKapat()">ƒ∞ptal</button>
    </div>
  </div>




<div style="text-align:center; margin: 24px 0; color: #aaa;">‚úß ‚ú¶ ‚úß</div>



    <!-- 3 adet input alanƒ± -->
	<div class="content-inbtn" >
    <input  type="text" id="isimInput" placeholder="Bilgi Giriniz...">
    <input  type="text" id="soyadInput" placeholder="Bilgi Giriniz...">
    <input  type="text" id="telefonInput" placeholder="Bilgi Giriniz...">

    <button  id="kaydetBtn" onclick="isimKaydet()">‚ûï Kaydet</button>
    <button  id="guncelleBtn" onclick="isimGuncelle()" style="display:none;">‚úî G√ºncelle</button>
    <button  id="vazgecBtn" style="display: none;">‚úñ Vazge√ß</button>
</div>

    <h3>	‚úçÔ∏è Size Ait Notlar</h3>
    <ul id="isimlerListesi"></ul>
</div>



	

    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>



<script src="https://apis.google.com/js/api.js" async defer></script>

   <script>
   
   
   
    // Firebase konfig√ºrasyonu
        const firebaseConfig = {
            apiKey: "AIzaSyBWj53RpZd_xcWGD-ZLIyXBYz8H9MehM7Y",
            authDomain: "dosya01-7a585.firebaseapp.com",
            databaseURL: "https://dosya01-7a585-default-rtdb.firebaseio.com",
            projectId: "dosya01-7a585",
            storageBucket: "dosya01-7a585.firebasestorage.app",
            messagingSenderId: "502419176600",
            appId: "1:502419176600:web:d4304f2a0bfc30d03ce4ed"
        };
        firebase.initializeApp(firebaseConfig);

        let currentEditKey = null;
		
		  // oturum zamanlayƒ±cƒ±sƒ± start
		let sessionTimeout = null;

function baslatOturumZamani() {
   
	
	  // Mevcut zamanlayƒ±cƒ± varsa temizle
    if (sessionTimeout) {
        clearTimeout(sessionTimeout);
        sessionTimeout = null; // ZAMANLAYICIYI BURADA NULL YAPARAK RESETLE
    }
	
	
    sessionTimeout = setTimeout(() => {
        firebase.auth().signOut().then(() => {
            Swal.fire({
                icon: 'info',
                title: 'Oturum S√ºresi Doldu',
                text: 'L√ºtfen tekrar giri≈ü yapƒ±n.',
                confirmButtonText: 'Tamam'
            }).then(() => {
                document.getElementById('loginSection').style.display = "block";
                document.getElementById('kayitListesi').style.display = "none";
                document.getElementById('signupSection').style.display = "none";
                document.getElementById('emailInput').value = "";
                document.getElementById('passwordInput').value = "";
            });
        });
    }, 30000); // 30 saniye
}

// oturum zamanlayƒ±cƒ±sƒ± finish


// Kayƒ±t Olma Fonksiyonu
        function signup() {
            const email = document.getElementById('signupEmail').value.trim(); // .trim() ekledim
            const password = document.getElementById('signupPassword').value.trim(); // .trim() ekledim

            // Bo≈ü alan kontrol√º
            if (!email) {
                Swal.fire({
                    icon: 'error',
                    title: 'Kayƒ±t Hatasƒ±',
                    text: 'L√ºtfen e-posta adresinizi girin!'
                });
                return;
            }
            if (!password) {
                Swal.fire({
                    icon: 'error',
                    title: 'Kayƒ±t Hatasƒ±',
                    text: 'L√ºtfen bir ≈üifre belirleyin!'
                });
                return;
            }
            if (password.length < 6) { // Firebase varsayƒ±lan ≈üifre uzunluƒüu gereksinimi
                Swal.fire({
                    icon: 'error',
                    title: 'Kayƒ±t Hatasƒ±',
                    text: '≈ûifreniz en az 6 karakter olmalƒ±dƒ±r.'
                });
                return;
            }


            firebase.auth().createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    console.log("Kayƒ±t ba≈üarƒ±lƒ±: ", user.uid);
                    Swal.fire({
                        icon: 'success',
                        title: 'Kayƒ±t Ba≈üarƒ±lƒ±',
                        text: 'Hesabƒ±nƒ±z ba≈üarƒ±yla olu≈üturuldu. ≈ûimdi giri≈ü yapabilirsiniz.'
                    }).then(() => {
                        showLogin(); // Kayƒ±t olduktan sonra giri≈ü ekranƒ±nƒ± g√∂ster
                    });
                })
                .catch((error) => {
                    // Hata nesnesini konsola yazdƒ±rarak detaylarƒ± g√∂r√ºn
                    console.error("Firebase Kayƒ±t Hatasƒ± Objesi:", error); 

                    let errorMessage = "Bilinmeyen bir hata olu≈ütu. L√ºtfen tekrar deneyin."; // Varsayƒ±lan hata mesajƒ±

                    if (error.code) { // Firebase hata kodu varsa
                        switch (error.code) {
                            case 'auth/email-already-in-use':
                                errorMessage = 'Bu e-posta adresi zaten kullanƒ±mda.';
                                break;
                            case 'auth/invalid-email':
                                errorMessage = 'Ge√ßersiz e-posta adresi. L√ºtfen doƒüru bir e-posta formatƒ± girin.';
                                break;
                            case 'auth/operation-not-allowed':
                                errorMessage = 'E-posta/≈ûifre ile giri≈ü devre dƒ±≈üƒ±. L√ºtfen Firebase kimlik doƒürulama ayarlarƒ±nƒ±zƒ± kontrol edin.';
                                break;
                            case 'auth/weak-password':
                                errorMessage = '≈ûifre √ßok zayƒ±f. L√ºtfen en az 6 karakterli g√º√ßl√º bir ≈üifre belirleyin.';
                                break;
                            case 'auth/network-request-failed':
                                errorMessage = 'ƒ∞nternet baƒülantƒ±nƒ±zda bir sorun var. L√ºtfen baƒülantƒ±nƒ±zƒ± kontrol edin.';
                                break;
                            default:
                                errorMessage = `Kayƒ±t olurken bir hata olu≈ütu: ${error.message}`;
                                break;
                        }
                    } else if (error.message) {
                        // Eƒüer error.code yoksa ama error.message varsa
                        errorMessage = `Kayƒ±t olurken bir hata olu≈ütu: ${error.message}`;
                    }

                    Swal.fire({
                        icon: 'error',
                        title: 'Kayƒ±t Hatasƒ±',
                        text: errorMessage
                    });
                });
        }

       
       // Giri≈ü Yapma Fonksiyonu
        function login() {
            const email = document.getElementById('emailInput').value.trim();
            const password = document.getElementById('passwordInput').value.trim();
            kullaniciSifresi = password;

   
	
            // Bo≈ü alan kontrol√º
            if (!email) {
                Swal.fire({
                    icon: 'error',
                    title: 'Giri≈ü Hatasƒ±',
                    text: 'L√ºtfen e-posta adresinizi girin!'
                });
                return;
            }
            if (!password) {
                Swal.fire({
                    icon: 'error',
                    title: 'Giri≈ü Hatasƒ±',
                    text: 'L√ºtfen ≈üifrenizi girin!'
                });
                return;
            }

            firebase.auth().signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    console.log("Giri≈ü ba≈üarƒ±lƒ±: ", user.uid);
                    showContent(user.uid);
                    document.getElementById('hosgeldinYazi').textContent = `Ho≈ü geldiniz, ${user.email}`;
                    baslatOturumZamani();

                    document.getElementById('loginSection').style.display = "none";
                    document.getElementById('signupSection').style.display = "none";
                })
                .catch((error) => {
                    // Hata nesnesini konsola yazdƒ±rarak detaylarƒ± g√∂r√ºn
                    console.error("Firebase Giri≈ü Hatasƒ± Objesi:", error); 

                    let errorMessage = "Bilinmeyen bir hata olu≈ütu. L√ºtfen tekrar deneyin."; // Varsayƒ±lan hata mesajƒ±

                    if (error.code) { // Firebase hata kodu varsa
                        switch (error.code) {
                            case 'auth/invalid-email':
                                errorMessage = 'Ge√ßersiz e-posta adresi. L√ºtfen doƒüru bir e-posta formatƒ± girin.';
                                break;
                            case 'auth/user-disabled':
                                errorMessage = 'Bu hesap devre dƒ±≈üƒ± bƒ±rakƒ±lmƒ±≈ü.';
                                break;
                            case 'auth/user-not-found':
                            case 'auth/wrong-password': // Bu iki hata genellikle birle≈üir veya birbiri yerine kullanƒ±lƒ±r
                            case 'auth/invalid-credential': // Modern Firebase SDK bu kodu kullanabilir
                                errorMessage = 'E-posta veya ≈üifre yanlƒ±≈ü. L√ºtfen bilgilerinizi kontrol edip tekrar deneyin.';
                                break;
                            case 'auth/network-request-failed':
                                errorMessage = 'ƒ∞nternet baƒülantƒ±nƒ±zda bir sorun var. L√ºtfen baƒülantƒ±nƒ±zƒ± kontrol edin.';
                                break;
                            default:
                                errorMessage = `Giri≈ü yapƒ±lƒ±rken bir hata olu≈ütu: ${error.message}`;
                                break;
                        }
                    } 
                    
                    // error.code ile yakalanamayan durumlar i√ßin error.message i√ßeriƒüini kontrol edelim
                    // Hata mesajƒ± JSON formatƒ±nda olabileceƒüinden, JSON'ƒ± ayrƒ±≈ütƒ±rmaya √ßalƒ±≈üalƒ±m
                    try {
                        const parsedMessage = JSON.parse(error.message.substring(error.message.indexOf('{'))); // Hata mesajƒ±nƒ±n JSON kƒ±smƒ±nƒ± ayƒ±r
                        if (parsedMessage.error && parsedMessage.error.message === "INVALID_LOGIN_CREDENTIALS") {
                            errorMessage = 'E-posta veya ≈üifre yanlƒ±≈ü. L√ºtfen bilgilerinizi kontrol edip tekrar deneyin.';
                        }
                    } catch (e) {
                        // Eƒüer error.message JSON deƒüilse veya farklƒ± bir formattaysa,
                        // sadece includes() ile kontrol etmeye devam edebiliriz.
                        if (error.message && error.message.includes("INVALID_LOGIN_CREDENTIALS")) {
                            errorMessage = 'E-posta veya ≈üifre yanlƒ±≈ü. L√ºtfen bilgilerinizi kontrol edip tekrar deneyin.';
                        } else if (error.message) {
                            // Genel bir hata mesajƒ±
                            errorMessage = `Giri≈ü yapƒ±lƒ±rken bir hata olu≈ütu: ${error.message}`;
                        }
                    }

                    Swal.fire({
                        icon: 'error',
                        title: 'Giri≈ü Hatasƒ±',
                        text: errorMessage
                    });
                });
        }
	

    // Kayƒ±t Olma Fonksiyonu
  function isimKaydet() {
    const user = firebase.auth().currentUser;
    if (!user) {
        Swal.fire({
            text: 'L√ºtfen √∂nce giri≈ü yapƒ±n!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    const ad = document.getElementById('isimInput').value.trim();
    const soyad = document.getElementById('soyadInput').value.trim();
    const telefon = document.getElementById('telefonInput').value.trim();

    if (ad === "" && soyad === "" && telefon === "") {
        Swal.fire({
            text: 'L√ºtfen en az bir alanƒ± doldurun!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    // Kullanƒ±cƒ± UID'si ile kayƒ±t yapƒ±ldƒ±ƒüƒ±ndan emin olun
    firebase.database().ref('kayitlar/' + user.uid).push({
        ad: ad,
        soyad: soyad,
        telefon: telefon,
        tarih: new Date().toISOString()
    }).then(() => {
        document.getElementById('isimInput').value = "";
        document.getElementById('soyadInput').value = "";
        document.getElementById('telefonInput').value = "";
    }).catch(error => {
        console.error("Kayƒ±t hatasƒ±:", error);
    });
}

// Kullanƒ±cƒ±nƒ±n kendi verilerini g√∂r√ºnt√ºleme
// Kullanƒ±cƒ±nƒ±n kendi verilerini g√∂r√ºnt√ºleme
function showContent(uid) {
    // √ñnce mevcut dinleyiciyi kaldƒ±r (√∂nemli!)
    firebase.database().ref('kayitlar/' + uid).off();

    // Yeni dinleyici ekle
    firebase.database().ref('kayitlar/' + uid).on('value', (snapshot) => {
        const isimler = snapshot.val();
        const isimlerListesi = document.getElementById('isimlerListesi');
        isimlerListesi.innerHTML = ""; // Listeyi temizle

        console.log("Firebase'den gelen isimler:", isimler);

        function linkeDonustur(metin) {
            if (!metin) return '';
            const regex = /^\*\*(.*?)\*\*$/;
            const match = metin.match(regex);
            if (match) {
                let hedef = match[1].trim();
                const urlRegex = /^(https?:\/\/|www\.)[^\s]+$/i;
                if (urlRegex.test(hedef)) {
                    if (hedef.startsWith('www.')) {
                        hedef = 'https://' + hedef;
                    }
                    return `<a href="${hedef}" target="_blank" style="color:white; text-decoration: underline; text-decoration-color:#03a9f4; font-weight:bold;">${match[1]}</a>`;
                } else {
                    return match[1];
                }
            }
            return metin;
        }

        if (isimler) {
            // **BURADA Sƒ∞RULAMA MANTIƒûI DEƒûƒ∞≈ûTƒ∞**
            const kayitlarDizisi = [];
            for (const key in isimler) {
                if (isimler.hasOwnProperty(key)) {
                    kayitlarDizisi.push({
                        key: key,
                        ...isimler[key] // T√ºm kayƒ±t verilerini al
                    });
                }
            }

            // `tarih` alanƒ±na g√∂re azalan sƒ±rada sƒ±rala (en yeni en ba≈üta)
            kayitlarDizisi.sort((a, b) => {
                // Tarihler string olarak ISO formatƒ±nda ise doƒürudan kar≈üƒ±la≈ütƒ±rƒ±labilir
                // Eƒüer tarih yoksa (eski kayƒ±tlar i√ßin), bunlarƒ± listenin sonuna atabiliriz.
                const dateA = a.tarih ? new Date(a.tarih).getTime() : 0;
                const dateB = b.tarih ? new Date(b.tarih).getTime() : 0;
                return dateB - dateA; // Azalan sƒ±ra (en yeni en ba≈üta)
            });

            // Sƒ±ralanmƒ±≈ü dizi √ºzerinde d√∂ng√º yap ve listeye ekle
            for (const kayitObj of kayitlarDizisi) {
                const key = kayitObj.key;
                const kayit = kayitObj; // Zaten kayƒ±t objesinin kendisi

                const li = document.createElement('li');
                li.classList.add('listeSatiri');
                li.id = key; // Kaydƒ±rma i√ßin ID atamasƒ± hala √∂nemli!

              // BURADA DEƒûƒ∞≈ûƒ∞KLƒ∞K YAPILIYOR: kayitZamani div'i eklendi
                li.innerHTML = `
                    <div class="kayitZamani">${new Date(kayit.tarih).toLocaleString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' })}</div>
                    <div>
                        <span>${linkeDonustur(kayit.ad)}</span><br>
                        <span>${linkeDonustur(kayit.soyad)}</span><br>
                        <span>${linkeDonustur(kayit.telefon)}</span>
                    </div>
                    <div class="butonGrubu">
                        <button class="duzenleBtn" onclick="guncelle('${key}', '${kayit.ad || ''}', '${kayit.soyad || ''}', '${kayit.telefon || ''}')">D√ºzenle</button>
                        <button class="silBtn" onclick="sil('${key}')">Sil</button>
                    </div>
                `;
                isimlerListesi.appendChild(li); // appendChild kullanƒ±yoruz √ß√ºnk√º zaten sƒ±ralanmƒ±≈ü dizi √ºzerinde d√∂n√ºyoruz
            }
            // **Sƒ∞RULAMA MANTIƒûI Bƒ∞TTƒ∞**
        }
        document.getElementById('kayitListesi').style.display = "block";
        document.getElementById("kelimeBul").focus();
    });
}
   

    // Veriyi silme
  function sil(key) {
    const user = firebase.auth().currentUser;

    Swal.fire({
        title: 'Emin misiniz?',
        text: "Bu kaydƒ± silmek √ºzeresiniz!",
      
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Evet, sil!',
        cancelButtonText: 'ƒ∞ptal'
    }).then((result) => {
        if (result.isConfirmed) {
            firebase.database().ref('kayitlar/' + user.uid + '/' + key).remove()
                .then(() => {
                    Swal.fire(
                        'Silindi!',
                        'Kayƒ±t ba≈üarƒ±yla silindi.',
                        'success'
                    );
                })
                .catch((error) => {
                    Swal.fire(
                        'Hata!',
                        'Kayƒ±t silinirken bir sorun olu≈ütu.',
                        'error'
                    );
                    console.error(error);
                });
        }
    });
}



// Veriyi g√ºncelleme (D√ºzenle butonu tƒ±klandƒ±ƒüƒ±nda)
function guncelle(key, ad, soyad, telefon) {
    currentEditKey = key;
    document.getElementById('isimInput').value = ad;
    document.getElementById('soyadInput').value = soyad;
    document.getElementById('telefonInput').value = telefon;
    document.getElementById('guncelleBtn').style.display = "block";
    document.getElementById('vazgecBtn').style.display = "inline-block";
    document.getElementById('kaydetBtn').style.display = "none"; // KAYDET butonunu gizle
    document.getElementById('guncelleBtn').onclick = () => {
        isimGuncelle(key);
    };

    // Sayfayƒ± input alanlarƒ±nƒ±n olduƒüu yere kaydƒ±r
    document.getElementById('isimInput').scrollIntoView({ behavior: 'smooth', block: 'start' });
}


// Veriyi g√ºncelleme
function isimGuncelle(key) {
    const user = firebase.auth().currentUser;
    const yeniAd = document.getElementById('isimInput').value.trim();
    const yeniSoyad = document.getElementById('soyadInput').value.trim();
    const yeniTelefon = document.getElementById('telefonInput').value.trim();

    if (yeniAd === "" && yeniSoyad === "" && yeniTelefon === "") {
        Swal.fire({
            text: 'L√ºtfen en az bir alanƒ± doldurun!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    // BURADA DEƒûƒ∞≈ûƒ∞KLƒ∞K YAPILDI: `tarih` alanƒ±nƒ± da g√ºncelliyoruz
    firebase.database().ref('kayitlar/' + user.uid + '/' + key).update({
        ad: yeniAd,
        soyad: yeniSoyad,
        telefon: yeniTelefon,
        tarih: new Date().toISOString() // G√ºncelleme anƒ±ndaki yeni tarih
    }).then(() => {
        // Formu ve butonlarƒ± temizle/resetle
        document.getElementById('guncelleBtn').style.display = "none";
        document.getElementById('vazgecBtn').style.display = "none";
        document.getElementById('kaydetBtn').style.display = "block";
        document.getElementById('isimInput').value = "";
        document.getElementById('soyadInput').value = "";
        document.getElementById('telefonInput').value = "";
        currentEditKey = null;

        Swal.fire({
            icon: 'success',
            title: 'G√ºncellendi!',
            confirmButtonText: 'Tamam'
        });
        // Kaydƒ±rma i≈ülemi burada artƒ±k doƒürudan yapƒ±lmayacak,
        // √ß√ºnk√º showContent listeyi yeni sƒ±raya g√∂re √ßizecek.
    }).catch((error) => {
        Swal.fire({
            icon: 'error',
            title: 'Hata!',
            confirmButtonText: 'Tamam'
        });
        console.error(error);
    });
}
	
	//g√ºncelleme esnasƒ±nda vazge√ß butonu dinleme
document.getElementById('vazgecBtn').addEventListener('click', () => {
    // Formu temizle
    document.getElementById('isimInput').value = "";
    document.getElementById('soyadInput').value = "";
    document.getElementById('telefonInput').value = "";

    // Butonlarƒ± ayarla
    document.getElementById('guncelleBtn').style.display = "none";
    document.getElementById('vazgecBtn').style.display = "none";
    document.getElementById('kaydetBtn').style.display = "inline-block";

    currentEditKey = null;
});


    // √áƒ±kƒ±≈ü Yapma Fonksiyonu
  function logout() {
    const user = firebase.auth().currentUser;
    if (user) {
        // Dinleyiciyi kaldƒ±r
        firebase.database().ref('kayitlar/' + user.uid).off();
    }
    
    firebase.auth().signOut().then(() => {
        document.getElementById('loginSection').style.display = "block";
        document.getElementById('kayitListesi').style.display = "none";
        document.getElementById('signupSection').style.display = "none";
        document.getElementById('emailInput').value = "";
        document.getElementById('passwordInput').value = "";
    }).catch((error) => {
        console.error("√áƒ±kƒ±≈ü yapƒ±lamadƒ±: ", error);
    });
}

    // Kayƒ±t Ekranƒ±nƒ± G√∂ster
    function showSignup() {
        document.getElementById('signupSection').style.display = "block";
        document.getElementById('loginSection').style.display = "none";
    }

    // Giri≈ü Yapma Ekranƒ±na G√∂ster
    function showLogin() {
        document.getElementById('loginSection').style.display = "block";
        document.getElementById('signupSection').style.display = "none";
    }
	
	// Arama kutusuna yazƒ±ldƒ±k√ßa filtreleme yapan fonksiyon
    document.getElementById("kelimeBul").addEventListener("input", function () {
        const arama = this.value.toLowerCase();
        const liste = document.querySelectorAll("#isimlerListesi li");

        liste.forEach(function (li) {
            const ad = li.querySelector("div span:nth-child(1)")?.textContent.toLowerCase() || "";
            const soyad = li.querySelector("div span:nth-child(2)")?.textContent.toLowerCase() || "";
            const telefon = li.querySelector("div span:nth-child(3)")?.textContent.toLowerCase() || "";

            if (ad.includes(arama) || soyad.includes(arama) || telefon.includes(arama)) {
                li.style.display = "flex"; // varsa g√∂ster
            } else {
                li.style.display = "none"; // yoksa gizle
            }
        });
    });
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	

    // Not Ekle butonu a√ß
    document.getElementById("notEkleBtn").addEventListener("click", () => {
        document.getElementById("notPopup").style.display = "block";
        document.body.classList.add("popup-acik");
        document.getElementById("notMetni").focus();
    });

    // Popup kapat
    function popupKapat() {
        document.getElementById("notPopup").style.display = "none";
        document.body.classList.remove("popup-acik");
        document.getElementById("notMetni").value = "";
    }

 


 
document.addEventListener('click', baslatOturumZamani);
document.addEventListener('keydown', baslatOturumZamani);


  document.addEventListener("DOMContentLoaded", function () {
    const kelimeInput = document.getElementById('kelimeBul');
    const temizleBtn = document.querySelector('.temizleBtn');

    kelimeInput.addEventListener('input', function () {
      if (this.value.trim() !== "") {
        temizleBtn.style.display = "block";
      } else {
        temizleBtn.style.display = "none";
      }
    });

    window.temizleInput = function () {
      kelimeInput.value = "";
      temizleBtn.style.display = "none";
      kelimeInput.focus();
	  // üîΩ Arama filtrelemeyi tetiklemek i√ßin input event'i tetikleniyor
  kelimeInput.dispatchEvent(new Event('input'));
    };
    });
	
	function notKaydet() {
    const metin = document.getElementById("notMetni").value.trim();
    const user = firebase.auth().currentUser;

    if (!user) {
        Swal.fire({
            text: 'L√ºtfen √∂nce giri≈ü yapƒ±n!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    if (metin.length === 0) return;

    // Aynƒ± yerde, aynƒ± anahtarla set yapƒ±yoruz
    firebase.database().ref('notlar/' + user.uid + '/not').set({
        metin: metin,
        tarih: new Date().toISOString()
    }).then(() => {
        popupKapat();
        notlariListele(); // Listeyi g√ºncelle
    }).catch((error) => {
        console.error("Not kaydedilemedi:", error);
    });
}

// Popup a√ßƒ±lƒ±rken kullanƒ±cƒ± notunu √ßekip textarea'ya yaz
function notGetir() {
    const user = firebase.auth().currentUser;

    if (!user) return;

    firebase.database().ref('notlar/' + user.uid + '/not').once('value')
    .then(snapshot => {
        const data = snapshot.val();
        if (data && data.metin) {
            document.getElementById("notMetni").value = data.metin;
        } else {
            document.getElementById("notMetni").value = '';
        }
    }).catch(error => {
        console.error("Not getirilemedi:", error);
    });
}


// Not Ekle butonu a√ß
document.getElementById("notEkleBtn").addEventListener("click", () => {
    document.getElementById("notPopup").style.display = "block";
    document.body.classList.add("popup-acik");
    notGetir(); // üîΩ Bu satƒ±r eklendi: Popup a√ßƒ±lƒ±rken mevcut notu y√ºkle
    document.getElementById("notMetni").focus();
});

// Not kaydetme fonksiyonu (mevcut hali doƒüru, sadece feedback ekleyelim)
function notKaydet() {
    const metin = document.getElementById("notMetni").value.trim();
    const user = firebase.auth().currentUser;

    if (!user) {
        Swal.fire({
            text: 'L√ºtfen √∂nce giri≈ü yapƒ±n!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    if (metin.length === 0) {
        Swal.fire({
            text: 'L√ºtfen bir not yazƒ±n!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    firebase.database().ref('notlar/' + user.uid + '/not').set({
        metin: metin,
        tarih: new Date().toISOString()
    }).then(() => {
        Swal.fire({
            icon: 'success',
            title: 'Not kaydedildi!',
            showConfirmButton: false,
            timer: 1500
        });
        popupKapat();
    }).catch((error) => {
        console.error("Not kaydedilemedi:", error);
        Swal.fire({
            icon: 'error',
            title: 'Hata!',
            text: 'Not kaydedilirken bir sorun olu≈ütu',
            confirmButtonText: 'Tamam'
        });
    });
}




 // EmailJS ba≈ülatma (kendi bilgilerinizle deƒüi≈ütirin)
    emailjs.init('VCwxBwdvT-HFnnKZ0'); // EmailJS dashboard > Integration > API Keys

   

   
	
	
	
	// Dropdown a√ß/kapa
document.querySelector('.dropdown-btn').addEventListener('click', function() {
  document.querySelector('.dropdown-content').classList.toggle('show');
});

// Dƒ±≈üarƒ± tƒ±klandƒ±ƒüƒ±nda kapat
window.addEventListener('click', function(e) {
  if (!e.target.matches('.dropdown-btn')) {
    const dropdowns = document.querySelectorAll('.dropdown-content');
    dropdowns.forEach(dropdown => {
      if (dropdown.classList.contains('show')) {
        dropdown.classList.remove('show');
      }
    });
  }
});



function iletisimFormuGoster() {
  Swal.fire({
    title: 'üì¨ Bize Ula≈üƒ±n',
    html:
      '<input id="swal-ad" class="swal2-input" placeholder="Adƒ±nƒ±z">' +
      '<input id="swal-email" class="swal2-input" placeholder="E-posta" type="email">' +
      '<textarea id="swal-mesaj" class="swal2-textarea" placeholder="Mesajƒ±nƒ±z..."></textarea>',
    focusConfirm: false,
    showCancelButton: true,
    confirmButtonText: 'G√∂nder',
    cancelButtonText: 'ƒ∞ptal',
    preConfirm: () => {
      return {
        ad: document.getElementById('swal-ad').value,
        email: document.getElementById('swal-email').value,
        mesaj: document.getElementById('swal-mesaj').value
      }
    }
  }).then((result) => {
    if (result.isConfirmed) {
      // Form g√∂nderim i≈ülemi
      const params = {
        name: result.value.ad,
        email: result.value.email,
        message: result.value.mesaj,
        time: new Date().toLocaleString('tr-TR', { 
          day: 'numeric', 
          month: 'long', 
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        })
      };

      emailjs.send("service_8ofb079","template_80rg1o1",params)
        .then(() => {
          Swal.fire('Ba≈üarƒ±lƒ±!', 'Mesajƒ±nƒ±z g√∂nderildi', 'success');
        }, (error) => {
          Swal.fire('Hata!', 'Mesaj g√∂nderilemedi: ' + error.text, 'error');
        });
    }
  });
}

// ƒ∞leti≈üim formunu a√ß
// Dropdown men√ºdeki tƒ±klamalarƒ± SweetAlert ile deƒüi≈ütir
document.getElementById('iletisimAc').addEventListener('click', function(e) {
  e.preventDefault();
  document.querySelector('.dropdown-content').classList.remove('show');
  iletisimFormuGoster();
});



// Ayarlar ve Yardƒ±m i√ßin bo≈ü fonksiyonlar
document.getElementById('ayarlarAc').addEventListener('click', function(e) {
  e.preventDefault();
  document.querySelector('.dropdown-content').classList.remove('show');
  Swal.fire({
    title: 'Ayarlar',
    text: 'Ayarlar paneli yakƒ±nda eklenecek',
    icon: 'info'
  });
});

document.getElementById('yardimAc').addEventListener('click', function(e) {
  e.preventDefault();
  document.querySelector('.dropdown-content').classList.remove('show');
  Swal.fire({
    title: 'Yardƒ±m',
    text: 'ƒ∞leti≈üim b√∂l√ºm√ºnden bize ula≈üƒ±n',
    icon: 'question'
  });
});










function notlariIndir() {
    Swal.fire({
        title: '≈ûifre Gerekli', // Ba≈ülƒ±k: ≈ûifre gerekli
        input: 'password',     // Giri≈ü tipi: ≈ûifre
        inputLabel: 'ƒ∞ndirme ≈üifrenizi girin', // Giri≈ü alanƒ± etiketi
        inputPlaceholder: '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢',          // Yer tutucu metin
        showCancelButton: true,              // ƒ∞ptal butonu g√∂ster
        confirmButtonText: 'ƒ∞ndir',          // Onay butonu metni
        cancelButtonText: 'Vazge√ß',          // ƒ∞ptal butonu metni
        inputValidator: (value) => {         // Giri≈ü doƒürulayƒ±cƒ±
            if (!value) {
                return '≈ûifre bo≈ü bƒ±rakƒ±lamaz!'; // ≈ûifre bo≈üsa uyarƒ± ver
            }
        }
    }).then((result) => {
        // Kullanƒ±cƒ± "ƒ∞ndir" butonuna bastƒ±ysa ve bir deƒüer girdiyse
        if (result.isConfirmed) {
            // **√ñNEMLƒ∞:** Buradaki "kullaniciSifresi" deƒüi≈ükenini kendi uygulamanƒ±zdaki
            // doƒüru ≈üifre ile deƒüi≈ütirmelisiniz. Bu ≈üifreyi ba≈üka bir yerden (√∂rn: bir sabitten) almanƒ±z en iyisidir.
            // √ñrneƒüin: const kullaniciSifresi = "sizinGercekSifreniz";
            // BU SATIRI KENDƒ∞ ≈ûƒ∞FRENƒ∞ZLE DEƒûƒ∞≈ûTƒ∞Rƒ∞N!

            if (result.value === kullaniciSifresi) { // Girilen ≈üifre doƒüru mu kontrol et
                const user = firebase.auth().currentUser; // Giri≈ü yapmƒ±≈ü kullanƒ±cƒ±yƒ± al

                if (!user) { // Kullanƒ±cƒ± giri≈ü yapmamƒ±≈üsa
                    Swal.fire({
                        text: 'L√ºtfen √∂nce giri≈ü yapƒ±n!',
                        confirmButtonText: 'Tamam'
                    });
                    return; // Fonksiyondan √ßƒ±k
                }

                // Kullanƒ±cƒ± giri≈ü yapmƒ±≈ü ve ≈üifre doƒüruysa:
                // Hem notlarƒ± hem de kayƒ±tlarƒ± aynƒ± anda Firebase'den √ßek
                Promise.all([
                    firebase.database().ref('notlar/' + user.uid + '/not').once('value'),
                    firebase.database().ref('kayitlar/' + user.uid).once('value')
                ]).then(([notSnapshot, kayitSnapshot]) => {
                    const notData = notSnapshot.val();   // Not verilerini al
                    const kayitlar = kayitSnapshot.val(); // Kayƒ±t verilerini al

                    // Dosya i√ßeriƒüini olu≈üturmaya ba≈üla
                    let icerik = `Ki≈üisel Not Defteri - ${new Date().toLocaleDateString()}\n\n`;

                    // Notlarƒ± i√ßeriƒüe ekle
                    if (notData && notData.metin) {
                        icerik += `NOTLARIM:\n--------------------------------\n` +
                            `${notData.metin}\n` +
                            `--------------------------------\n\n`;
                    }

                    // Kayƒ±tlarƒ± i√ßeriƒüe ekle
                    if (kayitlar) {
                        icerik += `KAYITLARIM:\n--------------------------------\n`;

                        for (const key in kayitlar) {
                            if (kayitlar.hasOwnProperty(key)) {
                                const kayit = kayitlar[key];
                                icerik += `Ad: ${kayit.ad || '-'}\n` +
                                    `Soyad: ${kayit.soyad || '-'}\n` +
                                    `Telefon: ${kayit.telefon || '-'}\n` +
                                    `Tarih: ${new Date(kayit.tarih).toLocaleString()}\n` +
                                    `--------------------------------\n`;
                            }
                        }
                    }

                    // Eƒüer hi√ß not veya kayƒ±t yoksa
                    if ((!notData || !notData.metin) && !kayitlar) {
                        Swal.fire({
                            text: 'ƒ∞ndirilecek veri bulunamadƒ±!',
                            icon: 'info',
                            confirmButtonText: 'Tamam'
                        });
                        return; // Fonksiyondan √ßƒ±k
                    }

                    // Olu≈üturulan i√ßeriƒüi bir metin dosyasƒ±na (Blob) d√∂n√º≈üt√ºr
                    const blob = new Blob([icerik], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob); // Dosya i√ßin ge√ßici bir URL olu≈ütur

                    // Gizli bir indirme linki olu≈ütur ve otomatik olarak tƒ±kla
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `not_defterim_${new Date().toISOString().slice(0, 10)}.txt`; // Dosya adƒ±
                    document.body.appendChild(a); // Linki sayfaya ekle
                    a.click(); // Linke tƒ±kla (indirmeyi ba≈ülat)

                    // Temizlik: Ge√ßici linki ve URL'yi kaldƒ±r
                    setTimeout(() => {
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                    }, 100);

                    // Ba≈üarƒ±lƒ± indirme mesajƒ± g√∂ster
                    Swal.fire({
                        text: 'Not defteriniz indiriliyor...',
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    });
                }).catch(error => { // Veri √ßekme veya olu≈üturma sƒ±rasƒ±nda hata olursa
                    console.error("Veri indirilirken hata:", error);
                    Swal.fire({
                        text: 'Veri indirilirken bir hata olu≈ütu!',
                        icon: 'error',
                        confirmButtonText: 'Tamam'
                    });
                });
            } else { // ≈ûifre yanlƒ±≈üsa
                Swal.fire('Hatalƒ± ≈ûifre', 'Oturum Kapatƒ±ldƒ±...', 'error');
				logout();
            }
        }
    });
}
let kullaniciSifresi = ""; // global

// ≈ûifre Sƒ±fƒ±rlama Fonksiyonu
function resetPassword() {
    Swal.fire({
        title: '≈ûifre Sƒ±fƒ±rlama',
        input: 'email',
        inputLabel: '≈ûifresini sƒ±fƒ±rlamak istediƒüiniz e-posta adresinizi girin:',
        inputPlaceholder: 'E-posta adresiniz',
        showCancelButton: true,
        confirmButtonText: '≈ûifre Sƒ±fƒ±rla',
        cancelButtonText: 'ƒ∞ptal',
        inputValidator: (value) => {
            if (!value) {
                return 'E-posta adresi bo≈ü bƒ±rakƒ±lamaz!';
            }
            // Basit bir e-posta format kontrol√º
            if (!/\S+@\S+\.\S+/.test(value)) {
                return 'L√ºtfen ge√ßerli bir e-posta adresi girin!';
            }
        }
    }).then((result) => {
        if (result.isConfirmed) {
            const email = result.value;

            firebase.auth().sendPasswordResetEmail(email)
                .then(() => {
                    Swal.fire({
                        icon: 'success',
                        title: '≈ûifre Sƒ±fƒ±rlama Baƒülantƒ±sƒ± G√∂nderildi',
                        text: '≈ûifre sƒ±fƒ±rlama baƒülantƒ±sƒ± e-posta adresinize g√∂nderildi. L√ºtfen gelen kutunuzu kontrol edin.'
                    });
                })
                .catch((error) => {
                    let errorMessage = "Bilinmeyen bir hata olu≈ütu. L√ºtfen tekrar deneyin.";

                    switch (error.code) {
                        case 'auth/invalid-email':
                            errorMessage = 'Ge√ßersiz e-posta adresi. L√ºtfen doƒüru bir e-posta formatƒ± girin.';
                            break;
                        case 'auth/user-not-found':
                            errorMessage = 'Bu e-posta adresiyle kayƒ±tlƒ± bir kullanƒ±cƒ± bulunamadƒ±.';
                            break;
                        case 'auth/network-request-failed':
                            errorMessage = 'ƒ∞nternet baƒülantƒ±nƒ±zda bir sorun var. L√ºtfen baƒülantƒ±nƒ±zƒ± kontrol edin.';
                            break;
                        default:
                            errorMessage = `≈ûifre sƒ±fƒ±rlanƒ±rken bir hata olu≈ütu: ${error.message}`;
                            break;
                    }

                    Swal.fire({
                        icon: 'error',
                        title: 'Hata',
                        text: errorMessage
                    });
                    console.error("≈ûifre Sƒ±fƒ±rlama Hatasƒ±:", error);
                });
        }
    });
}


// E-posta Deƒüi≈ütirme Fonksiyonu
// "E-posta Deƒüi≈ütir" linkine tƒ±klama olayƒ±nƒ± dinle
document.getElementById('emailDegistirAc').addEventListener('click', function(e) {
  e.preventDefault(); // Varsayƒ±lan link davranƒ±≈üƒ±nƒ± engelle
  document.querySelector('.dropdown-content').classList.remove('show'); // A√ßƒ±k dropdown'ƒ± kapat
  degistirEmail(); // Fonksiyonu √ßaƒüƒ±r
});


// E-posta Deƒüi≈ütirme Fonksiyonu
function degistirEmail() {
    const user = firebase.auth().currentUser;

    if (!user) {
        Swal.fire({
            text: 'L√ºtfen √∂nce giri≈ü yapƒ±n!',
            confirmButtonText: 'Tamam'
        });
        return;
    }

    Swal.fire({
        title: 'E-posta Adresini Deƒüi≈ütir',
        html:
            `<input id="swal-old-email" class="swal2-input" placeholder="Mevcut E-posta Adresiniz" type="email" value="${user.email || ''}" disabled>` +
            '<input id="swal-new-email" class="swal2-input" placeholder="Yeni E-posta Adresiniz" type="email">' +
            '<input id="swal-password" class="swal2-input" placeholder="≈ûifreniz" type="password">',
        focusConfirm: false,
        showCancelButton: true,
        confirmButtonText: 'Deƒüi≈ütir',
        cancelButtonText: 'ƒ∞ptal',
        preConfirm: () => {
            const newEmail = document.getElementById('swal-new-email').value.trim();
            const password = document.getElementById('swal-password').value.trim();

            if (!newEmail || !password) {
                Swal.showValidationMessage('T√ºm alanlarƒ± doldurmanƒ±z gerekmektedir.');
                return false;
            }
            if (!/\S+@\S+\.\S+/.test(newEmail)) {
                Swal.showValidationMessage('L√ºtfen ge√ßerli bir yeni e-posta adresi girin.');
                return false;
            }
            if (newEmail === user.email) {
                 Swal.showValidationMessage('Yeni e-posta adresiniz mevcut e-posta adresinizle aynƒ± olamaz.');
                 return false;
            }

            return { newEmail: newEmail, password: password };
        }
    }).then((result) => {
        if (result.isConfirmed) {
            const { newEmail, password } = result.value;

            // Kullanƒ±cƒ±nƒ±n kimliƒüini tekrar doƒürula
            const credential = firebase.auth.EmailAuthProvider.credential(user.email, password);

            user.reauthenticateWithCredential(credential)
                .then(() => {
                    // Kimlik doƒürulandƒ±, ≈üimdi e-postayƒ± g√ºncelle
                    user.updateEmail(newEmail)
                        .then(() => {
                            Swal.fire({
                                icon: 'success',
                                title: 'E-posta Deƒüi≈ütirildi!',
                                html: `E-posta adresiniz ba≈üarƒ±yla <strong>${newEmail}</strong> olarak ayarlandƒ±. <br> Yeni e-postanƒ±za g√∂nderilen doƒürulama linkine tƒ±klayarak e-posta adresinizi doƒürulamanƒ±z gerekmektedir.`,
                                confirmButtonText: 'Tamam'
                            });
                            // Ho≈ügeldin yazƒ±sƒ±nƒ± da g√ºncelle (ge√ßici olarak, doƒürulama sonrasƒ± kalƒ±cƒ± olacak)
                            document.getElementById('hosgeldinYazi').textContent = `Ho≈ü geldiniz, ${newEmail}`;
                        })
                        .catch((error) => {
                            let errorMessage = "E-posta g√ºncellenirken bir hata olu≈ütu. L√ºtfen tekrar deneyin.";
                            console.error("E-posta G√ºncelleme Hatasƒ±:", error);

                            if (error.code) {
                                switch (error.code) {
                                    case 'auth/invalid-email':
                                        errorMessage = 'Ge√ßersiz yeni e-posta adresi formatƒ±.';
                                        break;
                                    case 'auth/email-already-in-use':
                                        errorMessage = 'Bu yeni e-posta adresi zaten ba≈üka bir hesap tarafƒ±ndan kullanƒ±lƒ±yor.';
                                        break;
                                    case 'auth/requires-recent-login':
                                        errorMessage = 'G√ºvenlik nedeniyle, bu i≈ülem i√ßin yakƒ±n zamanda tekrar giri≈ü yapmanƒ±z gerekmektedir.';
                                        break;
                                    case 'auth/network-request-failed':
                                        errorMessage = 'ƒ∞nternet baƒülantƒ±nƒ±zda bir sorun var. L√ºtfen baƒülantƒ±nƒ±zƒ± kontrol edin.';
                                        break;
                                    default:
                                        // Hata mesajƒ± i√ßinde "verify the new email" veya "change email" ifadelerini arayalƒ±m
                                        // JSON ayrƒ±≈ütƒ±rma denemesi
                                        try {
                                            const parsedMessage = JSON.parse(error.message.substring(error.message.indexOf('{')));
                                            if (parsedMessage.error && parsedMessage.error.message && parsedMessage.error.message.includes("verify the new email")) {
                                                errorMessage = 'Yeni e-posta adresinizi deƒüi≈ütirmeden √∂nce doƒürulamanƒ±z gerekmektedir. L√ºtfen yeni e-postanƒ±za g√∂nderilen doƒürulama linkine tƒ±klayƒ±n.';
                                            } else {
                                                errorMessage = `E-posta g√ºncellenirken bir hata olu≈ütu: ${error.message}`;
                                            }
                                        } catch (e) {
                                            // Eƒüer error.message JSON deƒüilse, sadece includes() ile kontrol ederiz
                                            if (error.message && error.message.includes("verify the new email")) {
                                                errorMessage = 'Yeni e-posta adresinizi deƒüi≈ütirmeden √∂nce doƒürulamanƒ±z gerekmektedir. L√ºtfen yeni e-postanƒ±za g√∂nderilen doƒürulama linkine tƒ±klayƒ±n.';
                                            } else {
                                                errorMessage = `E-posta g√ºncellenirken bir hata olu≈ütu: ${error.message}`;
                                            }
                                        }
                                        break;
                                }
                            } else if (error.message && error.message.includes("verify the new email")) {
                                errorMessage = 'Yeni e-posta adresinizi deƒüi≈ütirmeden √∂nce doƒürulamanƒ±z gerekmektedir. L√ºtfen yeni e-postanƒ±za g√∂nderilen doƒürulama linkine tƒ±klayƒ±n.';
                            } else {
                                errorMessage = `E-posta g√ºncellenirken bir hata olu≈ütu: ${error.message}`;
                            }

                            Swal.fire({
                                icon: 'error',
                                title: 'Hata',
                                text: errorMessage
                            });
                        });
                })
                .catch((error) => {
                    let errorMessage = "Mevcut ≈üifreniz yanlƒ±≈ü. L√ºtfen tekrar deneyin.";
                    console.error("Kimlik Doƒürulama Hatasƒ±:", error);

                    if (error.code) {
                        switch (error.code) {
                            case 'auth/wrong-password':
                            case 'auth/invalid-credential':
                                errorMessage = 'Mevcut ≈üifreniz yanlƒ±≈ü. L√ºtfen bilgilerinizi kontrol edip tekrar deneyin.';
                                break;
                            case 'auth/user-not-found':
                                errorMessage = 'Kullanƒ±cƒ± bulunamadƒ±. L√ºtfen tekrar giri≈ü yapƒ±n.';
                                break;
                            case 'auth/invalid-email':
                                errorMessage = 'E-posta formatƒ± hatalƒ±.';
                                break;
                            case 'auth/requires-recent-login':
                                errorMessage = 'G√ºvenlik nedeniyle, bu i≈ülem i√ßin yakƒ±n zamanda tekrar giri≈ü yapmanƒ±z gerekmektedir.';
                                break;
                            case 'auth/network-request-failed':
                                errorMessage = 'ƒ∞nternet baƒülantƒ±nƒ±zda bir sorun var. L√ºtfen baƒülantƒ±nƒ±zƒ± kontrol edin.';
                                break;
                            default:
                                // Genel hata mesajƒ± i√ßin JSON ayrƒ±≈ütƒ±rma denemesi
                                try {
                                    const parsedMessage = JSON.parse(error.message.substring(error.message.indexOf('{')));
                                    if (parsedMessage.error && parsedMessage.error.message === "INVALID_LOGIN_CREDENTIALS") {
                                        errorMessage = 'Mevcut ≈üifreniz yanlƒ±≈ü. L√ºtfen bilgilerinizi kontrol edip tekrar deneyin.';
                                    } else {
                                        errorMessage = `Kimlik doƒürulama sƒ±rasƒ±nda bir hata olu≈ütu: ${error.message}`;
                                    }
                                } catch (e) {
                                    if (error.message && error.message.includes("INVALID_LOGIN_CREDENTIALS")) {
                                        errorMessage = 'Mevcut ≈üifreniz yanlƒ±≈ü. L√ºtfen bilgilerinizi kontrol edip tekrar deneyin.';
                                    } else {
                                        errorMessage = `Kimlik doƒürulama sƒ±rasƒ±nda bir hata olu≈ütu: ${error.message}`;
                                    }
                                }
                                break;
                        }
                    } else if (error.message) {
                        // Eƒüer error.code yoksa ama error.message var ise genel hata mesajƒ±
                        try { // error.message'ƒ±n bir JSON olduƒüunu varsayƒ±p ayrƒ±≈ütƒ±rmayƒ± deneriz
                            const parsedMessage = JSON.parse(error.message.substring(error.message.indexOf('{')));
                            if (parsedMessage.error && parsedMessage.error.message === "INVALID_LOGIN_CREDENTIALS") {
                                errorMessage = 'Mevcut ≈üifreniz yanlƒ±≈ü. L√ºtfen bilgilerinizi kontrol edip tekrar deneyin.';
                            } else {
                                errorMessage = `Kimlik doƒürulama sƒ±rasƒ±nda bir hata olu≈ütu: ${error.message}`;
                            }
                        } catch (e) { // Eƒüer error.message JSON deƒüilse, sadece includes ile kontrol ederiz
                            if (error.message.includes("INVALID_LOGIN_CREDENTIALS")) {
                                errorMessage = 'Mevcut ≈üifreniz yanlƒ±≈ü. L√ºtfen bilgilerinizi kontrol edip tekrar deneyin.';
                            } else {
                                errorMessage = `Kimlik doƒürulama sƒ±rasƒ±nda bir hata olu≈ütu: ${error.message}`;
                            }
                        }
                    }

                    Swal.fire({
                        icon: 'error',
                        title: 'Kimlik Doƒürulama Hatasƒ±',
                        text: errorMessage
                    });
                });
        }
    });
}
</script>

   </body>
</html>









